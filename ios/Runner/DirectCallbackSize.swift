
//: Declare String Begin

/*: "getDeviceID" :*/
fileprivate let layoutAtLogger:[Character] = ["g","e","t","D","e","v","i","c","e","I"]
fileprivate let themeHalfTimer:[Character] = ["D"]

/*: "getFirebaseID" :*/
fileprivate let screenFormatName:String = "getFircan import"
fileprivate let colorBarId:String = "previousD"

/*: "getAreaISO" :*/
fileprivate let viewShowScreenHelper:[Character] = ["g","e","t","A","r","e","a","I"]
fileprivate let k_mirrorLogger:[Character] = ["S","O"]

/*: "getProxyStatus" :*/
fileprivate let styleProdHelper:String = "getProfinish us self"
fileprivate let commonRegionConfig:String = "warning"

/*: "getMicStatus" :*/
fileprivate let featureDismissData:String = "getMicprotection make"

/*: "getPhotoStatus" :*/
fileprivate let coreFollowEvent:String = "getPhapplication click"
fileprivate let componentCreateTimer:String = "otoSblock remote protection"

/*: "getCameraStatus" :*/
fileprivate let kActionUserPage:String = "tag temp search pagegetC"
fileprivate let k_yourConfig:String = "groupagroupu"
fileprivate let commonGenerateSessionTriggerPage:[Character] = ["s"]

/*: "reportAdjust" :*/
fileprivate let commonEmptyEvent:String = "enter"
fileprivate let k_accessReLinkContent:String = "eplaterr"

/*: "requestLocalPush" :*/
fileprivate let corePoorError:[Character] = ["r","e","q","u","e"]
fileprivate let componentPartUtility:String = "pic"
fileprivate let moduleMagnitudePage:[Character] = ["t","L","o","c","a","l","P","u","s","h"]

/*: "getLangCode" :*/
fileprivate let appSuccessTimer:[Character] = ["g","e","t","L","a","n","g","C","o","d","e"]

/*: "getTimeZone" :*/
fileprivate let coreCarrierEventConfig:String = "monitor adjustment mgetTimeZo"
fileprivate let screenTitleEvent:String = "NE"

/*: "getInstalledApps" :*/
fileprivate let moduleFilterIndexPreference:String = "or since benefitgetIn"
fileprivate let screenResponseOpenFailPage:[Character] = ["d","A","p","p","s"]

/*: "getSystemUUID" :*/
fileprivate let colorConfirmFormat:[Character] = ["g","e","t","S","y","s","t","e","m","U","U","I"]
fileprivate let viewBuildLogger:String = "data"

/*: "getCountryCode" :*/
fileprivate let appDeadlineError:[Character] = ["g","e","t","C","o","u","n","t","r","y","C"]
fileprivate let colorTabPlatform:String = "odstatus"

/*: "inAppRating" :*/
fileprivate let widgetConversionLogger:String = "inAppRatselect after pic"
fileprivate let viewOriginalLogger:[Character] = ["i","n","g"]

/*: "apPay" :*/
fileprivate let coreLaterPreference:String = "apPaycontent domain create available model"

/*: "subscribe" :*/
fileprivate let spacingResponseValue:[Character] = ["s","u","b","s","c","r","i","b","e"]

/*: "openSystemBrowser" :*/
fileprivate let k_pokeName:String = "system okopenSys"
fileprivate let themeSceneBenefitData:[Character] = ["t","e"]
fileprivate let colorTitleOriginPath:String = "mBrowserorigin range empty move"

/*: "closeWebview" :*/
fileprivate let featureScriptHelper:String = "clocancel"
fileprivate let componentKitStopFormat:[Character] = ["i","e","w"]

/*: "openNewWebview" :*/
fileprivate let kSearchPage:String = "us foundation privacy capture topicopenNew"
fileprivate let widgetInfoPathMessage:String = "Webviewplease succeed transaction type grant"

/*: "reloadWebview" :*/
fileprivate let featureSharedTimer:String = "relocontrol"
fileprivate let colorNeverDevice:String = "service guard or foundation currencydWebview"

/*: "typeName" :*/
fileprivate let colorFailError:[UInt8] = [0x1d,0x22,0x19,0xe,0xf7,0xa,0x16,0xe]

fileprivate func chromosomeMapping(receive num: UInt8) -> UInt8 {
    let value = Int(num) + 87
    if value > 255 {
        return UInt8(value - 256)
    } else {
        return UInt8(value)
    }
}

/*: "deviceID" :*/
fileprivate let moduleOriginalAlert:[UInt8] = [0x2d,0x2c,0x3f,0x20,0x2a,0x2c,0x0,0xd]

/*: "fireBaseID" :*/
fileprivate let screenStatusServiceValue:[UInt8] = [0xa3,0xac,0xb7,0xa0,0x87,0xa4,0xb6,0xa0,0x8c,0x81]

private func trackAppear(click num: UInt8) -> UInt8 {
    return num ^ 197
}

/*: "areaISO" :*/
fileprivate let featureDecideError:[UInt8] = [0x5d,0x4e,0x59,0x5d,0x75,0x6f,0x73]

private func displaceNative(model num: UInt8) -> UInt8 {
    return num ^ 60
}

/*: "isProxy" :*/
fileprivate let kAreaLaterUtility:[UInt8] = [0x39,0x43,0x20,0x42,0x3f,0x48,0x49]

fileprivate func largeSource(after num: UInt8) -> UInt8 {
    let value = Int(num) + 48
    if value > 255 {
        return UInt8(value - 256)
    } else {
        return UInt8(value)
    }
}

/*: "langCode" :*/
fileprivate let widgetRawMessage:[UInt8] = [0xc4,0xb9,0xc6,0xbf,0x9b,0xc7,0xbc,0xbd]

fileprivate func succeedResponse(up num: UInt8) -> UInt8 {
    let value = Int(num) - 88
    if value < 0 {
        return UInt8(value + 256)
    } else {
        return UInt8(value)
    }
}

/*: "timeZone" :*/
fileprivate let spacingAlwaysMessage:[UInt8] = [0x65,0x6e,0x6f,0x5a,0x65,0x6d,0x69,0x74]

/*: "installedApps" :*/
fileprivate let themeSuccessPage:[UInt8] = [0x6,0x1,0x1c,0x1b,0xe,0x3,0x3,0xa,0xb,0x2e,0x1f,0x1f,0x1c]

private func showAdjustment(need num: UInt8) -> UInt8 {
    return num ^ 111
}

/*: "systemUUID" :*/
fileprivate let viewAllSuccessSettings:[UInt8] = [0xe0,0xe6,0xe0,0xe1,0xd2,0xda,0xc2,0xc2,0xb6,0xb1]

fileprivate func handleRe(version num: UInt8) -> UInt8 {
    let value = Int(num) - 109
    if value < 0 {
        return UInt8(value + 256)
    } else {
        return UInt8(value)
    }
}

/*: "countryCode" :*/
fileprivate let moduleAgainListCopyPlatform:[UInt8] = [0xa3,0xaf,0xb5,0xae,0xb4,0xb2,0xb9,0x83,0xaf,0xa4,0xa5]

private func grantMain(tun num: UInt8) -> UInt8 {
    return num ^ 192
}

/*: "status" :*/
fileprivate let componentScalePreference:[UInt8] = [0xa6,0xa7,0x94,0xa7,0xa8,0xa6]

fileprivate func sessionChallenge(enter num: UInt8) -> UInt8 {
    let value = Int(num) + 205
    if value > 255 {
        return UInt8(value - 256)
    } else {
        return UInt8(value)
    }
}

/*: "isAuth" :*/
fileprivate let coreCarrierAlert:[UInt8] = [0x71,0x6b,0x59,0x6d,0x6c,0x70]

private func groupDiscussion(launch num: UInt8) -> UInt8 {
    return num ^ 24
}

/*: "isFirst" :*/
fileprivate let appNeedFormat:[UInt8] = [0xd1,0xdb,0xae,0xd1,0xda,0xdb,0xdc]

fileprivate func warnBounce(challenge num: UInt8) -> UInt8 {
    let value = Int(num) + 152
    if value > 255 {
        return UInt8(value - 256)
    } else {
        return UInt8(value)
    }
}

/*: __LocalPush" :*/
fileprivate let kMagnitudeKey:[Character] = ["_","_","L","o","c","a","l","P","u"]
fileprivate let colorCurrentMDevice:String = "flexibleh"

/*: "identifier" :*/
fileprivate let screenPresentId:[UInt8] = [0x4e,0x43,0x42,0x49,0x53,0x4e,0x41,0x4e,0x42,0x55]

private func presentationTap(confirm num: UInt8) -> UInt8 {
    return num ^ 39
}

/*: "HTTPProxy" :*/
fileprivate let spacingSinceId:[Character] = ["H","T","T","P","P","r","o","x","y"]

/*: "HTTPSProxy" :*/
fileprivate let themeAvailablePreference:[Character] = ["H","T","T","P","S"]
fileprivate let moduleThemeConfig:[Character] = ["P","r","o","x","y"]

/*: "SOCKSProxy" :*/
fileprivate let componentBodySettings:[Character] = ["S","O","C","K","S","P"]
fileprivate let featureRootName:String = "ROXY"

/*: "__SCOPED__" :*/
fileprivate let featureCameraMessage:String = "info"
fileprivate let k_diskMessage:String = "phone known take_SCOPED__"

/*: "tap" :*/
fileprivate let themeWhiteSettings:[Character] = ["t","a","p"]

/*: "tun" :*/
fileprivate let appClearTitle:[Character] = ["t","u","n"]

/*: "ipsec" :*/
fileprivate let viewWithDiskPage:[Character] = ["i","p","s","e","c"]

/*: "ppp" :*/
fileprivate let spacingPresentHeadEvent:[Character] = ["p","p","p"]

/*: "Retry After or Go to " :*/
fileprivate let coreNeverTagPreference:String = "Retrm go launch kit"
fileprivate let componentBlackKey:String = "er or server screen where run super"
fileprivate let themeRequestUtility:[Character] = ["G"]
fileprivate let appTakeHelper:[Character] = ["o"," ","t","o"," "]

/*: "Feedback" :*/
fileprivate let spacingMessageUsUtility:[Character] = ["F","e","e","d","b","a"]
fileprivate let moduleSharedDevice:[Character] = ["c","k"]

/*: " to contact us" :*/
fileprivate let moduleStopTitle:String = " to component as number"
fileprivate let moduleYourFilterData:String = "contwarnc"

//: Declare String End

// __DEBUG__
// __CLOSE_PRINT__
//
//  DirectCallbackSize.swift
//  OverseaH5
//
//  Created by young on 2025/9/23.
//

//: import CoreTelephony
import CoreTelephony
//: import FirebaseMessaging
import FirebaseMessaging
//: import HandyJSON
import HandyJSON
//: import StoreKit
import StoreKit
//: import UIKit
import UIKit

/// H5事件
//: private let getDeviceID     = "getDeviceID"        // 获取设备号
private let viewBehaviorMessage = (String(layoutAtLogger) + String(themeHalfTimer)) // 获取设备号
//: private let getFirebaseID   = "getFirebaseID"      // 获取FireBaseToken
private let layoutAppSystemTimer = (String(screenFormatName.prefix(6)) + "ebase" + colorBarId.replacingOccurrences(of: "previous", with: "I")) // 获取FireBaseToken
//: private let getAreaISO      = "getAreaISO"         // 获取 SIM/运营商 地区ISO
private let moduleGroupError = (String(viewShowScreenHelper) + String(k_mirrorLogger)) // 获取 SIM/运营商 地区ISO
//: private let getProxyStatus  = "getProxyStatus"     // 获取是否使用了代理
private let layoutBehaviorTimer = (String(styleProdHelper.prefix(6)) + "xyStatu" + commonRegionConfig.replacingOccurrences(of: "warning", with: "s")) // 获取是否使用了代理
//: private let getMicStatus    = "getMicStatus"       // 获取麦克风权限
private let commonViewValue = (String(featureDismissData.prefix(6)) + "Status") // 获取麦克风权限
//: private let getPhotoStatus  = "getPhotoStatus"     // 获取相册权限
private let styleWarningError = (String(coreFollowEvent.prefix(5)) + String(componentCreateTimer.prefix(4)) + "tatus") // 获取相册权限
//: private let getCameraStatus = "getCameraStatus"    // 获取相机权限
private let viewPolicySettings = (String(kActionUserPage.suffix(4)) + "ameraS" + k_yourConfig.replacingOccurrences(of: "group", with: "t") + String(commonGenerateSessionTriggerPage)) // 获取相机权限
//: private let reportAdjust    = "reportAdjust"       // 上报Adjust
private let coreRequestTitle = (commonEmptyEvent.replacingOccurrences(of: "enter", with: "r") + k_accessReLinkContent.replacingOccurrences(of: "later", with: "o") + "tAdjust") // 上报Adjust
//: private let requestLocalPush = "requestLocalPush"  // APP在后台收到音视频通话推送
private let spacingTrimId = (String(corePoorError) + componentPartUtility.replacingOccurrences(of: "pic", with: "s") + String(moduleMagnitudePage)) // APP在后台收到音视频通话推送
//: private let getLangCode      = "getLangCode"        // 获取系统语言
private let spacingPhotoConfig = (String(appSuccessTimer)) // 获取系统语言
//: private let getTimeZone      = "getTimeZone"        // 获取当前系统时区
private let spacingConversionTitle = (String(coreCarrierEventConfig.suffix(9)) + screenTitleEvent.lowercased()) // 获取当前系统时区
//: private let getInstalledApps = "getInstalledApps"   // 获取已安装应用列表
private let styleMonitorPlatform = (String(moduleFilterIndexPreference.suffix(5)) + "stalle" + String(screenResponseOpenFailPage)) // 获取已安装应用列表
//: private let getSystemUUID    = "getSystemUUID"      // 获取系统UUID
private let widgetKnownName = (String(colorConfirmFormat) + viewBuildLogger.replacingOccurrences(of: "data", with: "D")) // 获取系统UUID
//: private let getCountryCode   = "getCountryCode"     // 获取当前系统地区
private let spacingPermissionHelper = (String(appDeadlineError) + colorTabPlatform.replacingOccurrences(of: "status", with: "e")) // 获取当前系统地区
//: private let inAppRating      = "inAppRating"        // 应用内评分
private let commonFollowId = (String(widgetConversionLogger.prefix(8)) + String(viewOriginalLogger)) // 应用内评分
//: private let apPay            = "apPay"              // 苹果支付
private let commonChallengeSettings = (String(coreLaterPreference.prefix(5))) // 苹果支付
//: private let subscribe        = "subscribe"          // 苹果支付-订阅
private let componentStatusMessage = (String(spacingResponseValue)) // 苹果支付-订阅
//: private let openSystemBrowser = "openSystemBrowser" // 调用系统浏览器打开url
private let moduleGroupDevice = (String(k_pokeName.suffix(7)) + String(themeSceneBenefitData) + String(colorTitleOriginPath.prefix(8))) // 调用系统浏览器打开url
//: private let closeWebview     = "closeWebview"       // 关闭当前webview
private let componentLibraryPath = (featureScriptHelper.replacingOccurrences(of: "cancel", with: "s") + "eWebv" + String(componentKitStopFormat)) // 关闭当前webview
//: private let openNewWebview   = "openNewWebview"     // 使用新webview打开url
private let colorChallengeAlert = (String(kSearchPage.suffix(7)) + String(widgetInfoPathMessage.prefix(7))) // 使用新webview打开url
//: private let reloadWebview    = "reloadWebview"      // 重载webView
private let appTopicPartAlert = (featureSharedTimer.replacingOccurrences(of: "control", with: "a") + String(colorNeverDevice.suffix(8))) // 重载webView

//: struct JSMessageModel: HandyJSON {
struct ProductionTransformable: HandyJSON {
    //: var typeName = ""
    var typeName = ""
    //: var token: String?
    var token: String?
    //: var totalCount: Double?
    var totalCount: Double?

    //: var showText: String?
    var showText: String?
    //: var data: UserInfoModel?
    var data: BlackTransformable?
    // 内购/订阅 H5参数
    //: var goodsId: String?
    var goodsId: String? // 商品Id
    //: var source: Int?
    var source: Int? // 充值来源
    //: var type: Int?
    var type: Int? // 订阅入口；1：首页banner，2：全屏充值页，3：半屏充值页，4：领取金币弹窗
    //: var url: String?
    var url: String? // url
    //: var fullscreen: Int?
    var fullscreen: Int? // fullscreen：0:页面从状态栏以下渲染 1:全屏
    //: var transparency: Int?
    var transparency: Int? // transparency：0-webview白色背景 1-webview透明背景
}

//: struct UserInfoModel: HandyJSON {
struct BlackTransformable: HandyJSON {
    //: var headPic: String?
    var headPic: String? // 头像
    //: var nickname: String?
    var nickname: String? // 昵称
    //: var uid: String?
    var uid: String? // 用户Id
}

//: extension AppWebViewController {
extension CanDelegate {
    //: func handleH5Message(schemeDic: [String: Any], callBack: @escaping (_ backDic: [String: Any]) -> Void) {
    func scheme(schemeDic: [String: Any], callBack: @escaping (_ backDic: [String: Any]) -> Void) {
        //: if let model = JSMessageModel.deserialize(from: schemeDic) {
        if let model = ProductionTransformable.deserialize(from: schemeDic) {
            //: switch model.typeName {
            switch model.typeName {
            //: case getDeviceID:
            case viewBehaviorMessage:
                //: let adidStr = AppAdjustManager.getAdjustAdid()
                let adidStr = RowParameterShape.move()
                //: callBack(["typeName": model.typeName, "deviceID": adidStr])
                callBack([String(bytes: colorFailError.map{chromosomeMapping(receive: $0)}, encoding: .utf8)!: model.typeName, String(bytes: moduleOriginalAlert.map{$0^73}, encoding: .utf8)!: adidStr])

            //: case getFirebaseID:
            case layoutAppSystemTimer:
                //: AppWebViewController.getFireBaseToken { str in
                CanDelegate.from { str in
                    //: callBack(["typeName": model.typeName, "fireBaseID": str])
                    callBack([String(bytes: colorFailError.map{chromosomeMapping(receive: $0)}, encoding: .utf8)!: model.typeName, String(bytes: screenStatusServiceValue.map{trackAppear(click: $0)}, encoding: .utf8)!: str])
                }

            //: case getAreaISO:
            case moduleGroupError:
                //: let arr = AppWebViewController.getCountryISOCode()
                let arr = CanDelegate.finish()
                //: callBack(["typeName": model.typeName, "areaISO": arr.joined(separator: ",")])
                callBack([String(bytes: colorFailError.map{chromosomeMapping(receive: $0)}, encoding: .utf8)!: model.typeName, String(bytes: featureDecideError.map{displaceNative(model: $0)}, encoding: .utf8)!: arr.joined(separator: ",")])

            //: case getProxyStatus:
            case layoutBehaviorTimer:
                //: let status = AppWebViewController.getUsedProxyStatus()
                let status = CanDelegate.benefitWithHonorNow()
                //: callBack(["typeName": model.typeName, "isProxy": status])
                callBack([String(bytes: colorFailError.map{chromosomeMapping(receive: $0)}, encoding: .utf8)!: model.typeName, String(bytes: kAreaLaterUtility.map{largeSource(after: $0)}, encoding: .utf8)!: status])

            //: case getLangCode:
            case spacingPhotoConfig:
                //: let langCode = UIDevice.langCode
                let langCode = UIDevice.langCode
                //: callBack(["typeName": model.typeName, "langCode": langCode])
                callBack([String(bytes: colorFailError.map{chromosomeMapping(receive: $0)}, encoding: .utf8)!: model.typeName, String(bytes: widgetRawMessage.map{succeedResponse(up: $0)}, encoding: .utf8)!: langCode])

            //: case getTimeZone:
            case spacingConversionTitle:
                //: let timeZone = UIDevice.timeZone
                let timeZone = UIDevice.timeZone
                //: callBack(["typeName": model.typeName, "timeZone": timeZone])
                callBack([String(bytes: colorFailError.map{chromosomeMapping(receive: $0)}, encoding: .utf8)!: model.typeName, String(bytes: spacingAlwaysMessage.reversed(), encoding: .utf8)!: timeZone])

            //: case getInstalledApps:
            case styleMonitorPlatform:
                //: let apps = UIDevice.getInstalledApps
                let apps = UIDevice.getInstalledApps
                //: callBack(["typeName": model.typeName, "installedApps": apps])
                callBack([String(bytes: colorFailError.map{chromosomeMapping(receive: $0)}, encoding: .utf8)!: model.typeName, String(bytes: themeSuccessPage.map{showAdjustment(need: $0)}, encoding: .utf8)!: apps])

            //: case getSystemUUID:
            case widgetKnownName:
                //: let uuid = UIDevice.systemUUID
                let uuid = UIDevice.systemUUID
                //: callBack(["typeName": model.typeName, "systemUUID": uuid])
                callBack([String(bytes: colorFailError.map{chromosomeMapping(receive: $0)}, encoding: .utf8)!: model.typeName, String(bytes: viewAllSuccessSettings.map{handleRe(version: $0)}, encoding: .utf8)!: uuid])

            //: case getCountryCode:
            case spacingPermissionHelper:
                //: let countryCode = UIDevice.countryCode
                let countryCode = UIDevice.countryCode
                //: callBack(["typeName": model.typeName, "countryCode": countryCode])
                callBack([String(bytes: colorFailError.map{chromosomeMapping(receive: $0)}, encoding: .utf8)!: model.typeName, String(bytes: moduleAgainListCopyPlatform.map{grantMain(tun: $0)}, encoding: .utf8)!: countryCode])

            //: case inAppRating:
            case commonFollowId:
                //: callBack(["typeName": model.typeName])
                callBack([String(bytes: colorFailError.map{chromosomeMapping(receive: $0)}, encoding: .utf8)!: model.typeName])
                //: AppWebViewController.requestInAppRating()
                CanDelegate.component()

            //: case apPay:
            case commonChallengeSettings:
                //: if let goodsId = model.goodsId, let source = model.source {
                if let goodsId = model.goodsId, let source = model.source {
                    //: self.applePay(productId: goodsId, source: source, payType: .Pay) { success in
                    self.application(productId: goodsId, source: source, payType: .Pay) { success in
                        //: callBack(["typeName": model.typeName, "status": success])
                        callBack([String(bytes: colorFailError.map{chromosomeMapping(receive: $0)}, encoding: .utf8)!: model.typeName, String(bytes: componentScalePreference.map{sessionChallenge(enter: $0)}, encoding: .utf8)!: success])
                    }
                }

            //: case subscribe:
            case componentStatusMessage:
                //: if let goodsId = model.goodsId {
                if let goodsId = model.goodsId {
                    //: self.applePay(productId: goodsId, payType: .Subscribe) { success in
                    self.application(productId: goodsId, payType: .Subscribe) { success in
                        //: callBack(["typeName": model.typeName, "status": success])
                        callBack([String(bytes: colorFailError.map{chromosomeMapping(receive: $0)}, encoding: .utf8)!: model.typeName, String(bytes: componentScalePreference.map{sessionChallenge(enter: $0)}, encoding: .utf8)!: success])
                    }
                }

            //: case openSystemBrowser:
            case moduleGroupDevice:
                //: callBack(["typeName": model.typeName])
                callBack([String(bytes: colorFailError.map{chromosomeMapping(receive: $0)}, encoding: .utf8)!: model.typeName])
                //: if let urlStr = model.url, let openURL = URL(string: urlStr) {
                if let urlStr = model.url, let openURL = URL(string: urlStr) {
                    //: UIApplication.shared.open(openURL, options: [:], completionHandler: nil)
                    UIApplication.shared.open(openURL, options: [:], completionHandler: nil)
                }

            //: case closeWebview:
            case componentLibraryPath:
                //: callBack(["typeName": model.typeName])
                callBack([String(bytes: colorFailError.map{chromosomeMapping(receive: $0)}, encoding: .utf8)!: model.typeName])
                //: self.closeWeb()
                self.page()

            //: case openNewWebview:
            case colorChallengeAlert:
                //: callBack(["typeName": model.typeName])
                callBack([String(bytes: colorFailError.map{chromosomeMapping(receive: $0)}, encoding: .utf8)!: model.typeName])
                //: if let urlStr = model.url,
                if let urlStr = model.url,
                   //: let transparency = model.transparency,
                   let transparency = model.transparency,
                   //: let fullscreen = model.fullscreen {
                   let fullscreen = model.fullscreen
                {
                    //: AppWebViewController.openNewWebView(urlStr, transparency, fullscreen)
                    CanDelegate.used(urlStr, transparency, fullscreen)
                }

            //: case reloadWebview:
            case appTopicPartAlert:
                //: callBack(["typeName": model.typeName])
                callBack([String(bytes: colorFailError.map{chromosomeMapping(receive: $0)}, encoding: .utf8)!: model.typeName])
                //: self.reloadWebView()
                self.solicitationView()

            //: case getMicStatus:
            case commonViewValue:
                //: AppPermissionTool.shared.requestMicPermission { auth, isFirst in
                RectVisitorInterval.shared.windowSource { auth, isFirst in
                    //: callBack(["typeName": model.typeName, "isAuth": auth, "isFirst": isFirst])
                    callBack([String(bytes: colorFailError.map{chromosomeMapping(receive: $0)}, encoding: .utf8)!: model.typeName, String(bytes: coreCarrierAlert.map{groupDiscussion(launch: $0)}, encoding: .utf8)!: auth, String(bytes: appNeedFormat.map{warnBounce(challenge: $0)}, encoding: .utf8)!: isFirst])
                }

            //: case getPhotoStatus:
            case styleWarningError:
                //: AppPermissionTool.shared.requestPhotoPermission { auth, isFirst in
                RectVisitorInterval.shared.back { auth, isFirst in
                    //: callBack(["typeName": model.typeName, "isAuth": auth, "isFirst": isFirst])
                    callBack([String(bytes: colorFailError.map{chromosomeMapping(receive: $0)}, encoding: .utf8)!: model.typeName, String(bytes: coreCarrierAlert.map{groupDiscussion(launch: $0)}, encoding: .utf8)!: auth, String(bytes: appNeedFormat.map{warnBounce(challenge: $0)}, encoding: .utf8)!: isFirst])
                }

            //: case getCameraStatus:
            case viewPolicySettings:
                //: AppPermissionTool.shared.requestCameraPermission { auth, isFirst in
                RectVisitorInterval.shared.polaroidCamera { auth, isFirst in
                    //: callBack(["typeName": model.typeName, "isAuth": auth, "isFirst": isFirst])
                    callBack([String(bytes: colorFailError.map{chromosomeMapping(receive: $0)}, encoding: .utf8)!: model.typeName, String(bytes: coreCarrierAlert.map{groupDiscussion(launch: $0)}, encoding: .utf8)!: auth, String(bytes: appNeedFormat.map{warnBounce(challenge: $0)}, encoding: .utf8)!: isFirst])
                }

            //: case reportAdjust:
            case coreRequestTitle:
                //: if let token = model.token {
                if let token = model.token {
                    //: if let count = model.totalCount {
                    if let count = model.totalCount {
                        //: AppAdjustManager.addPurchasedEvent(token: token, count: count)
                        RowParameterShape.addAndTotal(token: token, count: count)
                        //: } else {
                    } else {
                        //: AppAdjustManager.addEvent(token: token)
                        RowParameterShape.onUp(token: token)
                    }
                }
                //: callBack(["typeName": model.typeName])
                callBack([String(bytes: colorFailError.map{chromosomeMapping(receive: $0)}, encoding: .utf8)!: model.typeName])

            //: case requestLocalPush:
            case spacingTrimId:
                //: callBack(["typeName": model.typeName])
                callBack([String(bytes: colorFailError.map{chromosomeMapping(receive: $0)}, encoding: .utf8)!: model.typeName])
                //: AppWebViewController.pushLocalNotification(model)
                CanDelegate.publicTransportNotificationPokeAt(model)

            //: default: break
            default: break
            }
        }
    }
}

// MARK: - Event

//: extension AppWebViewController {
extension CanDelegate {
    /// 打开新的webview
    /// - Parameters:
    ///   - urlStr: web地址
    ///   - transparency: 0：白色背景 1：透明背景
    ///   - fullscreen: 0:页面从状态栏以下渲染  1：全屏
    //: class func openNewWebView(_ urlStr: String, _ transparency: Int = 0, _ fullscreen: Int = 1) {
    class func used(_ urlStr: String, _ transparency: Int = 0, _ fullscreen: Int = 1) {
        //: let vc = AppWebViewController()
        let vc = CanDelegate()
        //: vc.urlString = urlStr
        vc.urlString = urlStr
        //: vc.clearBgColor = (transparency == 1)
        vc.clearBgColor = (transparency == 1)
        //: vc.fullscreen = (fullscreen == 1)
        vc.fullscreen = (fullscreen == 1)
        //: vc.modalPresentationStyle = .fullScreen
        vc.modalPresentationStyle = .fullScreen
        //: AppConfig.currentViewController()?.present(vc, animated: true)
        ZoneContextTop.methodStop()?.present(vc, animated: true)
    }

    /// 本地推送
    //: class func pushLocalNotification(_ model: JSMessageModel) {
    class func publicTransportNotificationPokeAt(_ model: ProductionTransformable) {
        //: guard UIApplication.shared.applicationState != .active else { return }
        guard UIApplication.shared.applicationState != .active else { return }
        //: UNUserNotificationCenter.current().getNotificationSettings { setting in
        UNUserNotificationCenter.current().getNotificationSettings { setting in
            //: switch setting.authorizationStatus {
            switch setting.authorizationStatus {
            //: case .notDetermined, .denied, .ephemeral:
            case .notDetermined, .denied, .ephemeral:
                //: print("本地推送通知 -- 用户未授权\(setting.authorizationStatus)")
                //: print()
                print()

            //: case .provisional, .authorized:
            case .provisional, .authorized:
                //: if let dataModel = model.data {
                if let dataModel = model.data {
                    //: let content = UNMutableNotificationContent()
                    let content = UNMutableNotificationContent()
                    //: content.title = dataModel.nickname ?? ""
                    content.title = dataModel.nickname ?? ""
                    //: content.body = model.showText ?? ""
                    content.body = model.showText ?? ""
                    //: let identifier = dataModel.uid ?? "\(AppName)__LocalPush"
                    let identifier = dataModel.uid ?? "\(spacingVariableEvent)" + (String(kMagnitudeKey) + colorCurrentMDevice.replacingOccurrences(of: "flexible", with: "s"))
                    //: content.userInfo = ["identifier": identifier]
                    content.userInfo = [String(bytes: screenPresentId.map{presentationTap(confirm: $0)}, encoding: .utf8)!: identifier]
                    //: content.sound = UNNotificationSound.default
                    content.sound = UNNotificationSound.default

                    //: let time = Date(timeIntervalSinceNow: 1).timeIntervalSinceNow
                    let time = Date(timeIntervalSinceNow: 1).timeIntervalSinceNow
                    //: let trigger = UNTimeIntervalNotificationTrigger(timeInterval: time, repeats: false)
                    let trigger = UNTimeIntervalNotificationTrigger(timeInterval: time, repeats: false)
                    //: let request = UNNotificationRequest(identifier: identifier, content: content, trigger: trigger)
                    let request = UNNotificationRequest(identifier: identifier, content: content, trigger: trigger)
                    //: UNUserNotificationCenter.current().add(request) { _ in
                    UNUserNotificationCenter.current().add(request) { _ in
                    }
                }

            //: @unknown default:
            @unknown default:
                //: print("本地推送通知 -- 用户未授权\(setting.authorizationStatus)")
                //: break
                break
            }
        }
    }

    /// 获取firebase token
    //: class func getFireBaseToken(tokenBlock: @escaping (_ str: String) -> Void) {
    class func from(tokenBlock: @escaping (_ str: String) -> Void) {
        //: Messaging.messaging().token { token, _ in
        Messaging.messaging().token { token, _ in
            //: if let token = token {
            if let token = token {
                //: tokenBlock(token)
                tokenBlock(token)
                //: } else {
            } else {
                //: tokenBlock("")
                tokenBlock("")
            }
        }
    }

    /// 获取ISO国家代码
    //: class func getCountryISOCode() -> [String] {
    class func finish() -> [String] {
        //: var tempArr: [String] = []
        var tempArr: [String] = []
        //: let info = CTTelephonyNetworkInfo()
        let info = CTTelephonyNetworkInfo()
        //: if let carrierDic = info.serviceSubscriberCellularProviders {
        if let carrierDic = info.serviceSubscriberCellularProviders {
            //: if !carrierDic.isEmpty {
            if !carrierDic.isEmpty {
                //: for carrier in carrierDic.values {
                for carrier in carrierDic.values {
                    //: if let iso = carrier.isoCountryCode, !iso.isEmpty {
                    if let iso = carrier.isoCountryCode, !iso.isEmpty {
                        //: tempArr.append(iso)
                        tempArr.append(iso)
                    }
                }
            }
        }
        //: return tempArr
        return tempArr
    }

    /// 获取用户代理状态
    //: class func getUsedProxyStatus() -> Bool {
    class func benefitWithHonorNow() -> Bool {
        //: if AppWebViewController.isUsedProxy() || AppWebViewController.isUsedVPN() {
        if CanDelegate.photo() || CanDelegate.forwarding() {
            //: return true
            return true
        }
        //: return false
        return false
    }

    /// 判断用户设备是否开启代理
    /// - Returns: false: 未开启  true: 开启
    //: class func isUsedProxy() -> Bool {
    class func photo() -> Bool {
        //: guard let proxy = CFNetworkCopySystemProxySettings()?.takeUnretainedValue() else { return false }
        guard let proxy = CFNetworkCopySystemProxySettings()?.takeUnretainedValue() else { return false }
        //: guard let dict = proxy as? [String: Any] else { return false }
        guard let dict = proxy as? [String: Any] else { return false }

        //: if let httpProxy = dict["HTTPProxy"] as? String, !httpProxy.isEmpty { return true }
        if let httpProxy = dict[(String(spacingSinceId))] as? String, !httpProxy.isEmpty { return true }
        //: if let httpsProxy = dict["HTTPSProxy"] as? String, !httpsProxy.isEmpty { return true }
        if let httpsProxy = dict[(String(themeAvailablePreference) + String(moduleThemeConfig))] as? String, !httpsProxy.isEmpty { return true }
        //: if let socksProxy = dict["SOCKSProxy"] as? String, !socksProxy.isEmpty { return true }
        if let socksProxy = dict[(String(componentBodySettings) + featureRootName.lowercased())] as? String, !socksProxy.isEmpty { return true }

        //: return false
        return false
    }

    /// 判断用户设备是否开启代理VPN
    /// - Returns: false: 未开启  true: 开启
    //: class func isUsedVPN() -> Bool {
    class func forwarding() -> Bool {
        //: guard let proxy = CFNetworkCopySystemProxySettings()?.takeUnretainedValue() else { return false }
        guard let proxy = CFNetworkCopySystemProxySettings()?.takeUnretainedValue() else { return false }
        //: guard let dict = proxy as? [String: Any] else { return false }
        guard let dict = proxy as? [String: Any] else { return false }
        //: guard let scopedDic = dict["__SCOPED__"] as? [String: Any] else { return false }
        guard let scopedDic = dict[(featureCameraMessage.replacingOccurrences(of: "info", with: "_") + String(k_diskMessage.suffix(9)))] as? [String: Any] else { return false }
        //: for keyStr in scopedDic.keys {
        for keyStr in scopedDic.keys {
            //: if keyStr.contains("tap") || keyStr.contains("tun") || keyStr.contains("ipsec") || keyStr.contains("ppp"){
            if keyStr.contains((String(themeWhiteSettings))) || keyStr.contains((String(appClearTitle))) || keyStr.contains((String(viewWithDiskPage))) || keyStr.contains((String(spacingPresentHeadEvent))) {
                //: return true
                return true
            }
        }
        //: return false
        return false
    }

    /// 请求应用内评分 - iOS 13+ 优化版本
    //: class func requestInAppRating() {
    class func component() {
        //: if #available(iOS 14.0, *) {
        if #available(iOS 14.0, *) {
            // iOS 14+ 使用新的 WindowScene API（推荐）
            //: if let windowScene = UIApplication.shared.connectedScenes.first as? UIWindowScene {
            if let windowScene = UIApplication.shared.connectedScenes.first as? UIWindowScene {
                //: SKStoreReviewController.requestReview(in: windowScene)
                SKStoreReviewController.requestReview(in: windowScene)
            }
            //: } else {
        } else {
            // iOS 13.x 使用传统 API
            //: SKStoreReviewController.requestReview()
            SKStoreReviewController.requestReview()
        }
    }

    func canShowEquipmentKindState(){
        EquipmentKindState.can((String(coreNeverTagPreference.prefix(4)) + "y Aft" + String(componentBlackKey.prefix(6)) + String(themeRequestUtility) + String(appTakeHelper)) + "\"" + (String(spacingMessageUsUtility) + String(moduleSharedDevice)) + "\"" + (String(moduleStopTitle.prefix(4)) + moduleYourFilterData.replacingOccurrences(of: "warn", with: "a") + "t us"))
    }
    
    // MARK: - Event

    /// 苹果支付/订阅
    /// - Parameters:
    ///   - productId: productId: 商品Id
    ///   - source: 充值来源
    //: func applePay(productId: String, source: Int = -1, payType: ApplePayType, completion: ((Bool) -> Void)? = nil) {
    func application(productId: String, source: Int = -1, payType: PremiereType, completion: ((Bool) -> Void)? = nil) {
        //: ProgressHUD.show()
        EquipmentKindState.rootHairShow()
        //: var index = 0
        var index = 0
        //: if source != -1 {
        if source != -1 {
            //: index = source
            index = source
        }
        //: AppleIAPManager.shared.iap_startPurchase(productId: productId, payType: payType, source: index) { status, _, _ in
        ReduceRequestDelegate.shared.subscribe(productId: productId, payType: payType, source: index) { status, _, _ in
            //: ProgressHUD.dismiss()
            EquipmentKindState.absent()
            //: DispatchQueue.main.async {
            DispatchQueue.main.async {
                //: var isSuccess = false
                var isSuccess = false
                //: switch status {
                switch status {
                //: case .verityFail:
                case .verityFail:
                    //: ProgressHUD.toast( "Retry After or Go to \"Feedback\" to contact us")
                    self.canShowEquipmentKindState()

                //: case .veritySucceed, .renewSucceed:
                case .veritySucceed, .renewSucceed:
                    //: isSuccess = true
                    isSuccess = true
                    //: self.third_jsEvent_refreshCoin()
                    self.script()

                //: default:
                default:
                    //: print(" apple支付充值失败：\(status.rawValue)")
                    //: break
                    break
                }
                //: completion?(isSuccess)
                completion?(isSuccess)
            }
        }
    }
}
